<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Barom√®tre Public</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2553488319378463"
     crossorigin="anonymous"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 700px; margin: auto; padding: 20px; background: #f5f5f5; }
    h1 { text-align: center; }
    form { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .candidate { margin: 6px 0; }
    label { margin-left: 4px; }
    button { margin-top: 20px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
    #result { margin-top: 20px; font-weight: bold; color: #333; }
    .disclaimer { font-size: 0.9em; margin-top: 10px; color: #666; }
  </style>
</head>
<body>
  <h1>Barom√®tre Public</h1>
  <p>Si l‚Äô√©lection pr√©sidentielle avait lieu aujourd‚Äôhui, pour qui voteriez‚Äëvous&nbsp;?</p>
  <form id="voteForm">
    <!-- Centre / Ex‚Äëmacronie -->
    <div class="candidate"><input type="radio" name="candidate" id="philippe" value="√âdouard Philippe"><label for="philippe">√âdouard&nbsp;Philippe</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="attal" value="Gabriel Attal"><label for="attal">Gabriel&nbsp;Attal</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="lemaire" value="Bruno Le Maire"><label for="lemaire">Bruno&nbsp;Le&nbsp;Maire</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="darmanin" value="G√©rald Darmanin"><label for="darmanin">G√©rald&nbsp;Darmanin</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="bayrou" value="Fran√ßois Bayrou"><label for="bayrou">Fran√ßois&nbsp;Bayrou</label></div>

    <!-- Droite / RN / Souverainistes -->
    <div class="candidate"><input type="radio" name="candidate" id="lepen" value="Marine Le Pen"><label for="lepen">Marine&nbsp;Le&nbsp;Pen</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="bardella" value="Jordan Bardella"><label for="bardella">Jordan&nbsp;Bardella</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="zemmour" value="√âric Zemmour"><label for="zemmour">√âric&nbsp;Zemmour</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="dupont" value="Nicolas Dupont-Aignan"><label for="dupont">Nicolas&nbsp;Dupont‚ÄëAignan</label></div>

    <!-- Les R√©publicains -->
    <div class="candidate"><input type="radio" name="candidate" id="retailleau" value="Bruno Retailleau"><label for="retailleau">Bruno&nbsp;Retailleau</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="bertrand" value="Xavier Bertrand"><label for="bertrand">Xavier&nbsp;Bertrand</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="wauquiez" value="Laurent Wauquiez"><label for="wauquiez">Laurent&nbsp;Wauquiez</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="pecresse" value="Val√©rie P√©cresse"><label for="pecresse">Val√©rie&nbsp;P√©cresse</label></div>

    <!-- √âcologistes -->
    <div class="candidate"><input type="radio" name="candidate" id="tondelier" value="Marine Tondelier"><label for="tondelier">Marine&nbsp;Tondelier</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="rousseau" value="Sandrine Rousseau"><label for="rousseau">Sandrine&nbsp;Rousseau</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="jadot" value="Yannick Jadot"><label for="jadot">Yannick&nbsp;Jadot</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="batho" value="Delphine Batho"><label for="batho">Delphine&nbsp;Batho</label></div>

    <!-- Gauche / LFI / PS -->
    <div class="candidate"><input type="radio" name="candidate" id="autain" value="Cl√©mentine Autain"><label for="autain">Cl√©mentine&nbsp;Autain</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="ruffin" value="Fran√ßois Ruffin"><label for="ruffin">Fran√ßois&nbsp;Ruffin</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="melenchon" value="Jean-Luc M√©lenchon"><label for="melenchon">Jean‚ÄëLuc&nbsp;M√©lenchon</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="faure" value="Olivier Faure"><label for="faure">Olivier&nbsp;Faure</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="hollande" value="Fran√ßois Hollande"><label for="hollande">Fran√ßois&nbsp;Hollande</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="royal" value="S√©gol√®ne Royal"><label for="royal">S√©gol√®ne&nbsp;Royal</label></div>

    <!-- Extr√™me gauche / contestation -->
    <div class="candidate"><input type="radio" name="candidate" id="arthaud" value="Nathalie Arthaud"><label for="arthaud">Nathalie&nbsp;Arthaud</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="poutou" value="Philippe Poutou"><label for="poutou">Philippe&nbsp;Poutou</label></div>

    <!-- Options additionnelles -->
    <div class="candidate"><input type="radio" name="candidate" id="blanc" value="Vote blanc"><label for="blanc">Vote&nbsp;blanc</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="indecis" value="Ind√©cis"><label for="indecis">Ind√©cis</label></div>
    <div class="candidate"><input type="radio" name="candidate" id="nevotera" value="Ne votera pas"><label for="nevotera">Ne&nbsp;votera&nbsp;pas</label></div>

    <button type="button" id="voteButton" disabled>Valider mon vote</button>
  </form>

  <div id="result"></div>
  <p class="disclaimer">Ces r√©sultats refl√®tent uniquement les votes des utilisateurs de cette plateforme.</p>

  <script>
    </script>
<!-- SUPABASE -->
  <script>
  const SUPABASE_URL = "https://twldemyzpdeelatouccz.supabase.co";
  const SUPABASE_KEY = "sb_publishable_s2WGwh1hX88XYRokc4E01w_axS9n7ad";

  async function envoyerVote(candidate) {
    await fetch(`${SUPABASE_URL}/rest/v1/votes`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "apikey": SUPABASE_KEY,
        "Authorization": `Bearer ${SUPABASE_KEY}`
      },
      body: JSON.stringify({ candidate })
    });
    chargerResultats();
  }

  async function chargerResultats() {
    const r = await fetch(`${SUPABASE_URL}/rest/v1/votes?select=candidate`, {
      headers: {
        "apikey": SUPABASE_KEY,
        "Authorization": `Bearer ${SUPABASE_KEY}`
      }
    });
    const data = await r.json();

    const counts = {};
    data.forEach(v => {
      counts[v.candidate] = (counts[v.candidate] || 0) + 1;
    });

    let html = "<h2>R√©sultats</h2>";
    for (const c in counts) {
      html += `<p><strong>${c}</strong> : ${counts[c]}</p>`;
    }
    html += `<p style="font-size:13px;color:#666">
      Ces r√©sultats refl√®tent uniquement les votes des utilisateurs de cette plateforme.
    </p>`;

    document.getElementById("resultsBox").innerHTML = html;
  }

  document.addEventListener("DOMContentLoaded", () => {
    if (!document.getElementById("resultsBox")) {
      const div = document.createElement("div");
      div.id = "resultsBox";
      document.body.appendChild(div);
    }
document.getElementById("voteButton").addEventListener("click", async (e) => {
  e.preventDefault();

  // üîí Anti double vote
  if (localStorage.getItem("hasVoted") === "true") {
    alert("Vous avez d√©j√† vot√©. Merci !");
    return;
  }

  const c = document.querySelector('input[name="candidate"]:checked');
  if (!c) {
    alert("Choisis un candidat");
    return;
  }

  // On verrouille AVANT l'envoi
  localStorage.setItem("hasVoted", "true");

  await envoyerVote(c.value);

  document.getElementById("voteButton").disabled = true;
});


    chargerResultats();
  });
if (localStorage.getItem("hasVoted") === "true") {
  document.getElementById("voteButton").disabled = true;
}
</script>
<body>
</html>

